<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce Frontend</title>
</head>
<body>
    <h1>E-commerce Frontend</h1>

    <!-- Products Section -->
    <h2>Products</h2>
    <div id="products">
        <!-- Product list will be displayed here -->
    </div>

    <!-- Add Product Form -->
    <h2>Add Product</h2>
    <form id="addProductForm">
        <label for="productName">Name:</label>
        <input type="text" id="productName" name="productName" required><br>

        <label for="productDescription">Description:</label>
        <input type="text" id="productDescription" name="productDescription" required><br>

        <label for="productPrice">Price:</label>
        <input type="number" id="productPrice" name="productPrice" min="0" step="0.01" required><br>

        <label for="productCategory">Category:</label>
        <input type="text" id="productCategory" name="productCategory" required><br>

        <label for="productStock">Stock:</label>
        <input type="number" id="productStock" name="productStock" min="0" required><br>

        <button type="submit">Add Product</button>
    </form>

    <!-- Update Product Form -->
    <h2>Update Product</h2>
    <form id="updateProductForm">
        <label for="productIdToUpdate">Product ID:</label>
        <input type="text" id="productIdToUpdate" name="productIdToUpdate" required><br>

        <!-- Fields to update -->
        <label for="updatedProductName">Updated Name:</label>
        <input type="text" id="updatedProductName" name="updatedProductName"><br>

        <label for="updatedProductDescription">Updated Description:</label>
        <input type="text" id="updatedProductDescription" name="updatedProductDescription"><br>

        <label for="updatedProductPrice">Updated Price:</label>
        <input type="number" id="updatedProductPrice" name="updatedProductPrice" min="0" step="0.01"><br>

        <label for="updatedProductCategory">Updated Category:</label>
        <input type="text" id="updatedProductCategory" name="updatedProductCategory"><br>

        <label for="updatedProductStock">Updated Stock:</label>
        <input type="number" id="updatedProductStock" name="updatedProductStock" min="0"><br>

        <button type="submit">Update Product</button>
    </form>

    <!-- Remove Product Form -->
    <h2>Remove Product</h2>
    <form id="removeProductForm">
        <label for="productIdToRemove">Product ID:</label>
        <input type="text" id="productIdToRemove" name="productIdToRemove" required><br>

        <button type="submit">Remove Product</button>
    </form>

    <!-- Orders Section -->
    <h2>Orders</h2>
    <div id="orders">
        <!-- Order list will be displayed here -->
    </div>

    <!-- Add Order Form -->
    <h2>Add Order</h2>
    <form id="addOrderForm">
        <label for="userId">User ID:</label>
        <input type="text" id="userId" name="userId" required><br>

        <label for="productIds">Product IDs (comma-separated):</label>
        <input type="text" id="productIds" name="productIds" required><br>

        <label for="quantities">Quantities (comma-separated):</label>
        <input type="text" id="quantities" name="quantities" required><br>

        <button type="submit">Add Order</button>
    </form>

    <!-- Cart Section -->
    <h2>Cart</h2>
    <div id="cart">
        <!-- Cart details will be displayed here -->
    </div>

    <!-- Add to Cart Form -->
    <h2>Add to Cart</h2>
    <form id="addToCartForm">
        <label for="userIdCart">User ID:</label>
        <input type="text" id="userIdCart" name="userIdCart" required><br>

        <label for="productIdCart">Product ID:</label>
        <input type="text" id="productIdCart" name="productIdCart" required><br>

        <label for="quantityCart">Quantity:</label>
        <input type="number" id="quantityCart" name="quantityCart" min="1" required><br>

        <button type="submit">Add to Cart</button>
    </form>

    <!-- Remove from Cart Form -->
    <h2>Remove from Cart</h2>
    <form id="removeFromCartForm">
        <label for="userIdRemove">User ID:</label>
        <input type="text" id="userIdRemove" name="userIdRemove" required><br>

        <label for="productIdRemove">Product ID:</label>
        <input type="text" id="productIdRemove" name="productIdRemove" required><br>

        <button type="submit">Remove from Cart</button>
    </form>

    <script>
        // Function to fetch products from the server and display them
        async function fetchAndDisplayProducts() {
            const response = await fetch('/products');
            const products = await response.json();

            const productsDiv = document.getElementById('products');
            productsDiv.innerHTML = '';

            products.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.textContent = `ID: ${product.id}, Name: ${product.name}, Price: $${product.price}, In Stock: ${product.inStock ? 'Yes' : 'No'}`;
                productsDiv.appendChild(productDiv);
            });
        }

        // Function to add a new product
        async function addProduct(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            const response = await fetch('/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(Object.fromEntries(formData))
            });

            const newProduct = await response.json();
            console.log('New Product:', newProduct);

            form.reset();
            fetchAndDisplayProducts();
        }

        // Function to update a product
        async function updateProduct(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const productId = formData.get('productIdToUpdate');

            const response = await fetch(`/products/${productId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(Object.fromEntries(formData))
            });

            const updatedProduct = await response.json();
            console.log('Updated Product:', updatedProduct);

            form.reset();
            fetchAndDisplayProducts();
        }

        // Function to remove a product
        async function removeProduct(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const productIdToRemove = formData.get('productIdToRemove');

            const response = await fetch(`/products/${productIdToRemove}`, {
                method: 'DELETE'
            });

            const result = await response.json();
            console.log(result);

            form.reset();
            fetchAndDisplayProducts();
        }

        // Event listener for remove product form submission
        document.getElementById('removeProductForm').addEventListener('submit', removeProduct);

        // Function to fetch orders for a specific user
        async function fetchAndDisplayOrders(userId) {
            const response = await fetch(`/orders/${userId}`);
            const orders = await response.json();

            const ordersDiv = document.getElementById('orders');
            ordersDiv.innerHTML = '';

            orders.forEach(order => {
                const orderDiv = document.createElement('div');
                orderDiv.textContent = `Order ID: ${order.orderId}, Products: ${order.products.map(p => p.productId + '(' + p.quantity + ')').join(', ')}, Total Price: $${order.totalPrice}, Status: ${order.status}`;
                ordersDiv.appendChild(orderDiv);
            });
        }

        // Function to add a new order
        async function addOrder(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            const response = await fetch('/orders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(Object.fromEntries(formData))
            });

            const newOrder = await response.json();
            console.log('New Order:', newOrder);

            form.reset();
            fetchAndDisplayOrders(newOrder.userId);
        }

        // Function to fetch and display cart for a specific user
        async function fetchAndDisplayCart(userId) {
            const response = await fetch(`/cart/${userId}`);
            const cart = await response.json();

            const cartDiv = document.getElementById('cart');
            cartDiv.innerHTML = '';

            const cartItems = cart.items.map(item => `Product ID: ${item.productId}, Quantity: ${item.quantity}`).join('<br>');
            cartDiv.innerHTML = `User ID: ${cart.userId}<br>${cartItems}<br>Total Price: $${cart.totalPrice}`;
        }

        // Function to add a product to cart
        async function addToCart(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            const response = await fetch(`/cart/${formData.get('userIdCart')}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    productId: formData.get('productIdCart'),
                    quantity: formData.get('quantityCart')
                })
            });

            const updatedCart = await response.json();
            console.log('Updated Cart:', updatedCart);

            form.reset();
            fetchAndDisplayCart(updatedCart.userId);
        }

        // Function to remove a product from cart
        async function removeFromCart(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const userId = formData.get('userIdRemove');
            const productId = formData.get('productIdRemove');

            const response = await fetch(`/cart/${userId}/item/${productId}`, {
                method: 'DELETE'
            });

            const updatedCart = await response.json();
            console.log('Updated Cart:', updatedCart);

            form.reset();
            fetchAndDisplayCart(userId);
        }

        // Initial data loading
        fetchAndDisplayProducts();

        // Event listeners
        document.getElementById('addProductForm').addEventListener('submit', addProduct);
        document.getElementById('updateProductForm').addEventListener('submit', updateProduct);
        document.getElementById('addOrderForm').addEventListener('submit', addOrder);
        document.getElementById('addToCartForm').addEventListener('submit', addToCart);
        document.getElementById('removeFromCartForm').addEventListener('submit', removeFromCart);
    </script>
</body>
</html>
